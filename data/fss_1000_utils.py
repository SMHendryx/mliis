
import glob
import os
import random
from typing import List


def split_train_test_tasks(all_tasks: List[str], n_test, reproducbile_splits: bool = False):
    if not isinstance(all_tasks, list):
        all_tasks = list(all_tasks)
    if reproducbile_splits:
        all_tasks = sorted(all_tasks)
    else:
        random.shuffle(all_tasks)
    test_set = []
    for i in range(n_test):
        test_set.append(all_tasks.pop())
    assert_train_test_split(all_tasks, test_set)
    return all_tasks, test_set


def assert_train_test_split(train, test):
    for i in test:
        assert i not in train, "train-test leakage"


def get_fss_tasks(data_dir):
    return glob.glob(os.path.join(data_dir, "*.tfrecord*"))


def get_fss_test_set() -> List[str]:
    dirname = os.path.dirname(__file__)
    path = "fss_test_set.txt"  # File containing the test examples from the FSS-1000 authors.
    filename = os.path.join(dirname, path)
    with open(filename, "r") as file:
        tasks = [line.rstrip("\n") for line in file]
    return tasks


def get_fss_train_set() -> List[str]:
    dirname = os.path.dirname(__file__)
    path = "fss_train_set.txt"
    filename = os.path.join(dirname, path)
    with open(filename, "r") as file:
        tasks = [line.rstrip("\n") for line in file]
    return tasks


def get_fp_k_test_set() -> List[str]:
    dirname = os.path.dirname(__file__)
    path = "fp-k_test_set.txt"  # File containing the test examples from the FSS-1000 authors.
    filename = os.path.join(dirname, path)
    with open(filename, "r") as file:
        tasks = [line.rstrip("\n") for line in file]
    return tasks


# TEST_TASK_IDS = ['rock_beauty.tfrecord.gzip', 'mortar.tfrecord.gzip', 'mitten.tfrecord.gzip', 'lionfish.tfrecord.gzip', 'litchi.tfrecord.gzip', 'cardoon.tfrecord.gzip', 'egyptian_cat.tfrecord.gzip', 'forklift.tfrecord.gzip', 'garfish.tfrecord.gzip', 'cuckoo.tfrecord.gzip', 'fur_coat.tfrecord.gzip', 'crocodile.tfrecord.gzip', 'kitchen_knife.tfrecord.gzip', 'hook.tfrecord.gzip', 'killer_whale.tfrecord.gzip', 'leopard.tfrecord.gzip', 'chess_knight.tfrecord.gzip', 'almond.tfrecord.gzip', 'poached_egg.tfrecord.gzip', 'stopwatch.tfrecord.gzip', 'scarerow.tfrecord.gzip', 'giant_panda.tfrecord.gzip', 'motor_scooter.tfrecord.gzip', 'spiderman.tfrecord.gzip', 'carp.tfrecord.gzip', 'sleeping_bag.tfrecord.gzip', 'manatee.tfrecord.gzip', 'egg.tfrecord.gzip', 'sloth_bear.tfrecord.gzip', 'airliner.tfrecord.gzip', 'shih-tzu.tfrecord.gzip', 'housefinch.tfrecord.gzip', 'pinwheel.tfrecord.gzip', 'frying_pan.tfrecord.gzip', 'groenendael.tfrecord.gzip', 'orange.tfrecord.gzip', 'goblet.tfrecord.gzip', 'church.tfrecord.gzip', 'fennel_bulb.tfrecord.gzip', 'whiptail.tfrecord.gzip', 'gecko.tfrecord.gzip', 'manx.tfrecord.gzip', 'rhinoceros.tfrecord.gzip', 'paper_crane.tfrecord.gzip', 'screwdriver.tfrecord.gzip', 'coffee_mug.tfrecord.gzip', 'iceberg.tfrecord.gzip', 'black_bear.tfrecord.gzip', 'louvre_pyramid.tfrecord.gzip', 'african_crocodile.tfrecord.gzip', 'triceratops.tfrecord.gzip', 'pomelo.tfrecord.gzip', 'one-armed_bandit.tfrecord.gzip', 'parking_meter.tfrecord.gzip', 'bee_eater.tfrecord.gzip', 'vinyl.tfrecord.gzip', 'missile.tfrecord.gzip', 'turtle.tfrecord.gzip', 'arrow.tfrecord.gzip', 'windsor_tie.tfrecord.gzip', 'koala.tfrecord.gzip', 'tebby_cat.tfrecord.gzip', 'vestment.tfrecord.gzip', 'pickelhaube.tfrecord.gzip', 'pineapple.tfrecord.gzip', 'excavator.tfrecord.gzip', 'balance_weight.tfrecord.gzip', 'bowtie.tfrecord.gzip', 'balance_beam.tfrecord.gzip', 'broom.tfrecord.gzip', 'conversion_plug.tfrecord.gzip', 'speedboat.tfrecord.gzip', 'little_blue_heron.tfrecord.gzip', 'croquet_ball.tfrecord.gzip', 'diver.tfrecord.gzip', 'bath_ball.tfrecord.gzip', 'jacko_lantern.tfrecord.gzip', 'table_lamp.tfrecord.gzip', 'seal.tfrecord.gzip', 'steam_locomotive.tfrecord.gzip', 'indian_elephant.tfrecord.gzip', 'prayer_rug.tfrecord.gzip', 'potato_chips.tfrecord.gzip', 'psp.tfrecord.gzip', 'surfboard.tfrecord.gzip', 'digital_watch.tfrecord.gzip', 'wash_basin.tfrecord.gzip', 'mite_predator.tfrecord.gzip', 'seagull.tfrecord.gzip', 'sundial.tfrecord.gzip', 'hammer.tfrecord.gzip', 'flat-coated_retriever.tfrecord.gzip', 'feeder.tfrecord.gzip', 'umbrella.tfrecord.gzip', 'rose.tfrecord.gzip', 'recreational_vehicle.tfrecord.gzip', 'poker.tfrecord.gzip', 'can_opener.tfrecord.gzip', 'apple.tfrecord.gzip', 'seatbelt.tfrecord.gzip', 'kazoo.tfrecord.gzip', 'pillow.tfrecord.gzip', 'window_shade.tfrecord.gzip', 'jet_aircraft.tfrecord.gzip', 'chicken_leg.tfrecord.gzip', 'boa_constrictor.tfrecord.gzip', 'iguana.tfrecord.gzip', 'equestrian_helmet.tfrecord.gzip', 'rubber_eraser.tfrecord.gzip', 'soap_dispenser.tfrecord.gzip', 'ashtray.tfrecord.gzip', 'tiger_shark.tfrecord.gzip', 'water_bike.tfrecord.gzip', 'staffordshire.tfrecord.gzip', 'sock.tfrecord.gzip', 'children_slide.tfrecord.gzip', 'christmas_stocking.tfrecord.gzip', 'canton_tower.tfrecord.gzip', 'panda.tfrecord.gzip', 'tower_pisa.tfrecord.gzip', 'shift_gear.tfrecord.gzip', 'handkerchief.tfrecord.gzip', 'tunnel.tfrecord.gzip', 'rally_car.tfrecord.gzip', 'peanut.tfrecord.gzip', 'cactus_ball.tfrecord.gzip', 'cabbage_butterfly.tfrecord.gzip', 'cd.tfrecord.gzip', 'wooden_boat.tfrecord.gzip', 'bathtub.tfrecord.gzip', 'chihuahua.tfrecord.gzip', 'rice_cooker.tfrecord.gzip', 'puma_logo.tfrecord.gzip', 'roller_skate.tfrecord.gzip', 'panther.tfrecord.gzip', 'dwarf_beans.tfrecord.gzip', 'persian_cat.tfrecord.gzip', 'porcupine.tfrecord.gzip', 'bullet_train.tfrecord.gzip', 'ptarmigan.tfrecord.gzip', 'golden_plover.tfrecord.gzip', 'monitor.tfrecord.gzip', 'flute.tfrecord.gzip', 'carrot.tfrecord.gzip', 'revolver.tfrecord.gzip', 'chinese_knot.tfrecord.gzip', 'red_bayberry.tfrecord.gzip', 'saltshaker.tfrecord.gzip', 'teapot.tfrecord.gzip', "abe's_flyingfish.tfrecord.gzip", 'lettuce.tfrecord.gzip', 'potted_plant.tfrecord.gzip', 'solar_dish.tfrecord.gzip', 'drake.tfrecord.gzip', 'printer.tfrecord.gzip', 'motarboard.tfrecord.gzip', 'kobe_logo.tfrecord.gzip', 'sushi.tfrecord.gzip', 'haddock.tfrecord.gzip', 'langur.tfrecord.gzip', 'bulbul_bird.tfrecord.gzip', 'pinecone.tfrecord.gzip', 'sungnyemun.tfrecord.gzip', 'collar.tfrecord.gzip', 'papaya.tfrecord.gzip', 'totem_pole.tfrecord.gzip', 'pubg_lvl3backpack.tfrecord.gzip', 'convertible.tfrecord.gzip', 'gyromitra.tfrecord.gzip', 'projector.tfrecord.gzip', 'tile_roof.tfrecord.gzip', 'tray.tfrecord.gzip', 'wafer.tfrecord.gzip', 'beet_root.tfrecord.gzip', 'quill_pen.tfrecord.gzip', 'narcissus.tfrecord.gzip', 'monkey.tfrecord.gzip', 'leather_shoes.tfrecord.gzip', 'ladle.tfrecord.gzip', 'common_newt.tfrecord.gzip', 'helicopter.tfrecord.gzip', 'scabbard.tfrecord.gzip', 'ox.tfrecord.gzip', 'quail.tfrecord.gzip', 'tank.tfrecord.gzip', 'snowplow.tfrecord.gzip', 'cabbage.tfrecord.gzip', 'studio_couch.tfrecord.gzip', 'leaf_fan.tfrecord.gzip', 'cablestayed_bridge.tfrecord.gzip', 'bouzouki.tfrecord.gzip', 'shower_cap.tfrecord.gzip', 'stinkhorn.tfrecord.gzip', 'flying_disc.tfrecord.gzip', 'oriole.tfrecord.gzip', 'adidas_logo2.tfrecord.gzip', 'egret.tfrecord.gzip', 'cocktail_shaker.tfrecord.gzip', 'space_shuttle.tfrecord.gzip', 'flatworm.tfrecord.gzip', 'accordion.tfrecord.gzip', 'bee.tfrecord.gzip', 'doughnut.tfrecord.gzip', 'roller_coaster.tfrecord.gzip', 'chicken.tfrecord.gzip', 'feather_clothes.tfrecord.gzip', 'fire_screen.tfrecord.gzip', 'abacus.tfrecord.gzip', 'ocicat.tfrecord.gzip', 'turnstile.tfrecord.gzip', 'starfish.tfrecord.gzip', 'water_buffalo.tfrecord.gzip', 'dugong.tfrecord.gzip', 'sarong.tfrecord.gzip', 'ganeva_chair.tfrecord.gzip', 'fish_eagle.tfrecord.gzip', 'basketball.tfrecord.gzip', 'orang.tfrecord.gzip', 'washer.tfrecord.gzip', 'pay_phone.tfrecord.gzip', 'american_chamelon.tfrecord.gzip', 'cello.tfrecord.gzip', 'dutch_oven.tfrecord.gzip', 'tomb.tfrecord.gzip', 'microwave.tfrecord.gzip', 'cougar.tfrecord.gzip', 'sewing_machine.tfrecord.gzip', 'nintendo_3ds.tfrecord.gzip', 'fountain.tfrecord.gzip', 'cherry.tfrecord.gzip', 'brown_bear.tfrecord.gzip', 'bittern.tfrecord.gzip', 'redheart.tfrecord.gzip', 'chainsaw.tfrecord.gzip', 'refrigerator.tfrecord.gzip', 'melon_seed.tfrecord.gzip', 'mouthpiece.tfrecord.gzip', 'stork.tfrecord.gzip', 'leafhopper.tfrecord.gzip', 'wrench.tfrecord.gzip']
# locally produced:
# TEST_TASK_IDS = ['chess_bishop.tfrecord.gzip', 'lifeboat.tfrecord.gzip', 'african_grey.tfrecord.gzip', 'kobe_logo.tfrecord.gzip', 'ab_wheel.tfrecord.gzip', 'face_powder.tfrecord.gzip', 'gourd.tfrecord.gzip', 'ski_mask.tfrecord.gzip', 'stool.tfrecord.gzip', 'vine_snake.tfrecord.gzip', 'ladle.tfrecord.gzip', 'wandering_albatross.tfrecord.gzip', 'agama.tfrecord.gzip', 'school_bus.tfrecord.gzip', 'ballpoint.tfrecord.gzip', 'radio.tfrecord.gzip', 'television.tfrecord.gzip', 'orange.tfrecord.gzip', 'mitten.tfrecord.gzip', 'pizza.tfrecord.gzip', 'sealion.tfrecord.gzip', 'toaster.tfrecord.gzip', 'window_shade.tfrecord.gzip', 'corn.tfrecord.gzip', 'albatross.tfrecord.gzip', 'african_elephant.tfrecord.gzip', 'pidan.tfrecord.gzip', 'taxi.tfrecord.gzip', 'cardoon.tfrecord.gzip', 'indian_elephant.tfrecord.gzip', 'moon.tfrecord.gzip', 'pistachio.tfrecord.gzip', 'brambling.tfrecord.gzip', 'fire_screen.tfrecord.gzip', 'quail_egg.tfrecord.gzip', 'yawl.tfrecord.gzip', 'pencil_box.tfrecord.gzip', 'rhinoceros.tfrecord.gzip', 'bighorn_sheep.tfrecord.gzip', 'diver.tfrecord.gzip', 'bison.tfrecord.gzip', 'golden_retriever.tfrecord.gzip', 'stretcher.tfrecord.gzip', 'prairie_chicken.tfrecord.gzip', 'zebra.tfrecord.gzip', 'water_heater.tfrecord.gzip', 'espresso_maker.tfrecord.gzip', 'sundial.tfrecord.gzip', 'stop_sign.tfrecord.gzip', 'microsd.tfrecord.gzip', 'mite_predator.tfrecord.gzip', 'sports_car.tfrecord.gzip', 'mount_fuji.tfrecord.gzip', 'pyramid.tfrecord.gzip', 'truss_bridge.tfrecord.gzip', 'giant_panda.tfrecord.gzip', 'walnut.tfrecord.gzip', 'hippo.tfrecord.gzip', 'loggerhead_turtle.tfrecord.gzip', 'avocado.tfrecord.gzip', 'partridge.tfrecord.gzip', 'telescope.tfrecord.gzip', 'fan.tfrecord.gzip', 'egyptian_cat.tfrecord.gzip', 'tile_roof.tfrecord.gzip', 'potato_chips.tfrecord.gzip', 'chinese_knot.tfrecord.gzip', 'cradle.tfrecord.gzip', 'garbage_can.tfrecord.gzip', 'guitar.tfrecord.gzip', 'airship.tfrecord.gzip', 'spoonbill.tfrecord.gzip', 'pencil_sharpener2.tfrecord.gzip', 'acorn.tfrecord.gzip', 'turnstile.tfrecord.gzip', 'cn_tower.tfrecord.gzip', 'typewriter.tfrecord.gzip', 'microscope.tfrecord.gzip', 'hornbill.tfrecord.gzip', 'ashtray.tfrecord.gzip', 'scorpion.tfrecord.gzip', 'vestment.tfrecord.gzip', 'combination_lock.tfrecord.gzip', 'hare.tfrecord.gzip', 'nintendo_gba.tfrecord.gzip', 'titi_monkey.tfrecord.gzip', 'golfcart.tfrecord.gzip', 'garbage_truck.tfrecord.gzip', 'candle.tfrecord.gzip', 'pyraminx.tfrecord.gzip', 'nagoya_castle.tfrecord.gzip', 'beaker.tfrecord.gzip', 'scissors.tfrecord.gzip', 'feather_clothes.tfrecord.gzip', 'american_alligator.tfrecord.gzip', 'fish_eagle.tfrecord.gzip', "abe's_flyingfish.tfrecord.gzip", 'streetcar.tfrecord.gzip', 'jacko_lantern.tfrecord.gzip', 'taj_mahal.tfrecord.gzip', 'stole.tfrecord.gzip', 'sunscreen.tfrecord.gzip', 'poached_egg.tfrecord.gzip', 'aubergine.tfrecord.gzip', 'calculator.tfrecord.gzip', 'lobster.tfrecord.gzip', 'swimming_trunk.tfrecord.gzip', 'power_drill.tfrecord.gzip', 'windsor_tie.tfrecord.gzip', 'sandwich_cookies.tfrecord.gzip', 'kazoo.tfrecord.gzip', 'indian_cobra.tfrecord.gzip', 'soap_dispenser.tfrecord.gzip', 'spotted_salamander.tfrecord.gzip', 'strawberry.tfrecord.gzip', 'warplane.tfrecord.gzip', 'flying_squirrel.tfrecord.gzip', 'tennis_racket.tfrecord.gzip', 'dragonfly.tfrecord.gzip', 'crepe.tfrecord.gzip', 'skull.tfrecord.gzip', 'starfish.tfrecord.gzip', 'shovel.tfrecord.gzip', 'electronic_toothbrush.tfrecord.gzip', 'bra.tfrecord.gzip', 'chess_knight.tfrecord.gzip', 'white_shark.tfrecord.gzip', 'red_fox.tfrecord.gzip', 'smoothing_iron.tfrecord.gzip', 'colubus.tfrecord.gzip', 'flying_disc.tfrecord.gzip', 'excavator.tfrecord.gzip', 'toothbrush.tfrecord.gzip', 'peregine_falcon.tfrecord.gzip', 'polo_shirt.tfrecord.gzip', 'magpie_bird.tfrecord.gzip', 'apple_icon.tfrecord.gzip', 'triumphal_arch.tfrecord.gzip', 'bottle_cap.tfrecord.gzip', 'great_wall.tfrecord.gzip', 'ac_wall.tfrecord.gzip', 'manatee.tfrecord.gzip', 'pinwheel.tfrecord.gzip', 'nintendo_3ds.tfrecord.gzip', 'pinecone.tfrecord.gzip', 'melon_seed.tfrecord.gzip', 'ruler.tfrecord.gzip', 'wrench.tfrecord.gzip', 'throne.tfrecord.gzip', 'pomegranate.tfrecord.gzip', 'killer_whale.tfrecord.gzip', 'tiger.tfrecord.gzip', 'shih-tzu.tfrecord.gzip', 'croquet_ball.tfrecord.gzip', 'conch.tfrecord.gzip', 'oscilloscope.tfrecord.gzip', 'frog.tfrecord.gzip', 'coho.tfrecord.gzip', 'golf_ball.tfrecord.gzip', 'monitor.tfrecord.gzip', 'sparrow.tfrecord.gzip', 'paper_plane.tfrecord.gzip', 'tiger_cat.tfrecord.gzip', 'seal.tfrecord.gzip', 'buckingham_palace.tfrecord.gzip', 'waffle_iron.tfrecord.gzip', 'sewing_machine.tfrecord.gzip', 'paper_crane.tfrecord.gzip', 'dumbbell.tfrecord.gzip', 'quail.tfrecord.gzip', 'band-aid.tfrecord.gzip', 'beer_glass.tfrecord.gzip', 'ox.tfrecord.gzip', 'hawk.tfrecord.gzip', 'spider_monkey.tfrecord.gzip', 'pufferfish.tfrecord.gzip', 'cuckoo.tfrecord.gzip', 'carrot.tfrecord.gzip', 'sweatshirt.tfrecord.gzip', 'terrapin_turtle.tfrecord.gzip', 'arctic_fox.tfrecord.gzip', 'eletrical_switch.tfrecord.gzip', 'african_crocodile.tfrecord.gzip', 'electronic_stove.tfrecord.gzip', 'timber_wolf.tfrecord.gzip', 'hammer.tfrecord.gzip', 'wagtail.tfrecord.gzip', 'cushion.tfrecord.gzip', 'angora.tfrecord.gzip', 'mario.tfrecord.gzip', 'paper_towel.tfrecord.gzip', 'kit_fox.tfrecord.gzip', 'snail.tfrecord.gzip', 'snowball.tfrecord.gzip', 'gazelle.tfrecord.gzip', 'fig.tfrecord.gzip', 'cloud.tfrecord.gzip', 'nike_logo.tfrecord.gzip', 'scarerow.tfrecord.gzip', 'lacewing.tfrecord.gzip', 'letter_opener.tfrecord.gzip', 'hover_board.tfrecord.gzip', 'eft_newt.tfrecord.gzip', 'black_swan.tfrecord.gzip', 'file_cabinet.tfrecord.gzip', 'turtle.tfrecord.gzip', 'assult_rifle.tfrecord.gzip', 'sandbar.tfrecord.gzip', 'monkey.tfrecord.gzip', 'common_newt.tfrecord.gzip', 'rocket.tfrecord.gzip', 'triceratops.tfrecord.gzip', 'siamese_cat.tfrecord.gzip', 'panda.tfrecord.gzip', 'mountain_tent.tfrecord.gzip', 'mortar.tfrecord.gzip', 'adhensive_tape.tfrecord.gzip', 'afghan_hound.tfrecord.gzip', 'mule.tfrecord.gzip', 'tomb.tfrecord.gzip', 'air_strip.tfrecord.gzip', 'orang.tfrecord.gzip', 'space_shuttle.tfrecord.gzip', 'aircraft_carrier.tfrecord.gzip', 'tofu.tfrecord.gzip', 'cello.tfrecord.gzip', 'water_buffalo.tfrecord.gzip', 'sulphur_crested.tfrecord.gzip', 'garlic.tfrecord.gzip', 'besom.tfrecord.gzip', 'baby.tfrecord.gzip', 'beer_bottle.tfrecord.gzip', 'pingpong_ball.tfrecord.gzip', 'coucal.tfrecord.gzip', 'grey_whale.tfrecord.gzip', 'drumstick.tfrecord.gzip', 'banjo.tfrecord.gzip', 'flamingo.tfrecord.gzip', 'plate.tfrecord.gzip', 'mcdonald_sign.tfrecord.gzip']

TEST_TASK_IDS = get_fss_test_set()
TRAIN_TASK_IDS = get_fss_train_set()
FP_K_TEST_TASK_IDS = get_fp_k_test_set()
TOTAL_NUM_FSS_CLASSES = 1000
IMAGE_DIMS = 224  # Length of one side of input images. Images assumed to be square.
